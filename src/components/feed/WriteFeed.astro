---
import fs from "node:fs";
import path from "path";
import { promisify } from "node:util";

const writeFile = promisify(fs.writeFile);
const makeDir = promisify(fs.mkdir);

try {
    if (Astro.slots.has("feed-writer")) {
      const html = await Astro.slots.render("feed-writer");
      const feedPath = path.resolve(process.cwd(), "src/feeds");
      if(!fs.existsSync(feedPath))
        await makeDir(feedPath)
      await writeFile(path.resolve(process.cwd(), "src/feeds/rss.xml"), html);
      console.log("Written feed succesfully"); 
    }
} catch (e) {
    console.error("There was an error trying to write the feed");
    console.error(e);
}
---